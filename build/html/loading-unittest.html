<!DOCTYPE HTML>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="utf-8">
  <title>Smoosic Unit Tests</title>
  <link href="https://aarondavidnewman.github.io/Smoosic/build/styles/fonts.css" rel="stylesheet">
  <link href="https://aarondavidnewman.github.io/Smoosic/build/styles/media.css" rel="stylesheet">
  <link href="https://aarondavidnewman.github.io/Smoosic/build/styles/ribbon.css" rel="stylesheet">
  <link href="https://aarondavidnewman.github.io/Smoosic/build/styles/dialogs.css" rel="stylesheet">
  <link href="https://aarondavidnewman.github.io/Smoosic/build/styles/menus.css" rel="stylesheet">
  <link href="https://aarondavidnewman.github.io/Smoosic/build/styles/piano.css" rel="stylesheet">
  <link href="https://aarondavidnewman.github.io/Smoosic/build/styles/tree.css" rel="stylesheet">
  <link href="../qunit.css" rel="stylesheet">
  <script type="text/javascript"
    src="https://aarondavidnewman.github.io/vexflow_smoosic/releases/vexflow-debug.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"
    integrity="sha512-uVSVjE7zYsGz4ag0HEzfugJ78oHCI1KhdkivjQro8ABL/PRiEO4ROwvrolYAcZnky0Fl/baWKYilQfWvESliRA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- script type="text/javascript" src="../../../vex_smoosic/vexflow_smoosic/build/vexflow-debug.js"></script  -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.js"></script>
  <script type="text/javascript" src="../midi-parser.js"></script>
  <script type="text/javascript" src="../qunit.js"></script>
  <script type="text/javascript" src="../smoosic.js"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function (event) {
      // A simple music program using Smoosic in library mode.  
      // Load a Smoosic JSON file and render the score
      const jsonPath = 'https://aarondavidnewman.github.io/Smoosic/release/library/hymns/Precious Lord.json';
      const midiTiesPath = 'https://aarondavidnewman.github.io/Smoosic/release/library/miditest/ties.mid';
      const midiTripletPath = 'https://aarondavidnewman.github.io/Smoosic/release/library/miditest/triplet.mid';
      const midiKeyPath = 'https://aarondavidnewman.github.io/Smoosic/release/library/miditest/keytime.mid';
      var app = async (Smo, application) => {
        const view = application.view
        await view.loadRemoteScore(jsonPath);
        await view.renderPromise();
        QUnit.test('loaded', assert => {
          assert.equal(view.score.staves[0].measures.length, 17);
          assert.equal($('#boo .vf-lyric').length, 82);
        });
        const xml = Smo.SmoToXml.convert(view.score);
        const newScore = Smo.XmlToSmo.convert(xml);
        await view.changeScore(newScore);
        QUnit.test('loadXml', assert => {
          assert.equal(view.score.staves[0].measures.length, 17);
          assert.equal($('#boo .vf-lyric').length, 82);
        });
        let midiData = new Smo.SuiXhrLoader(midiTiesPath);
        await midiData.loadAsync();
        let midiScore = (new Smo.MidiToSmo(parseMidi(midiData.value), 1024)).convert();
        await view.changeScore(midiScore);
        QUnit.test('loadMidi1', assert => {
          assert.equal(midiScore.staves[0].getTiesEndingAt({staff: 0, measure: 1, voice: 0, tick: 0 }).length, 1);
        });
        midiData = new Smo.SuiXhrLoader(midiTripletPath);
        await midiData.loadAsync();
        midiScore = (new Smo.MidiToSmo(parseMidi(midiData.value), 1024)).convert();
        await view.changeScore(midiScore);
        QUnit.test('loadMidi2', assert => {
          assert.equal(midiScore.staves[0].measures[0].tuplets.length, 1);
        });

        // console.log('measures ' + view.score.staves[0].measures.length);
      };

      Smo.SuiApplication.configure({
                   mode: 'library',
                   idleRedrawTime: 5,
                   scoreDomContainer: 'outer-container'
      }).then((application) => {
        app(Smo, application)
      });
    })
  </script>
</head>

<body>
  <div id="qunit"></div>
  <!-- audio crossOrigin="anonymous" id="sample" src="https://aarondavidnewman.github.io/Smoosic/build/sound/piano_middle_C.mp3" / -->
  <div id="outer-container" style="overflow:auto">
    <div id="container1">

    </div>
  </div>
</body>

</html>